# FFAB 文件格式

FFA Bundle (.ffab) 是一种二进制文件格式，用于存储序列帧图片资源。该格式设计简洁高效，支持快速随机访问任意帧，特别适合动画播放场景。

## 概述

FFAB 格式专为高性能帧动画设计，具有以下特点：

- 简洁的二进制结构，解析速度快
- 支持快速随机访问任意帧
- 紧凑的索引表
- 支持多种图片压缩格式

## 文件结构

FFAB 文件由三部分组成：

1. **文件头 (Header)**：包含文件标识、版本信息、图片数量等基本信息
2. **索引表 (Index Table)**：每张图片的位置和长度信息
3. **图片数据区 (Data)**：存储所有压缩后的图片数据

```
+-------------------+
|   文件头 (10字节)   |
+-------------------+
|   索引表           |
|   (Count * 12字节) |
+-------------------+
|   图片数据区        |
|   (可变长度)        |
+-------------------+
```

## 文件头格式

文件头固定为 10 字节，包含以下字段：

```
偏移量  长度    类型         描述
0      2      uint16       魔数 (0xFFAB)
2      1      uint8        版本号 (当前为 0x01)
3      2      uint16       图片总数 (最大 0xFFFF)
5      2      uint16       图片宽度 (最大 0xFFFF)
7      2      uint16       图片高度 (最大 0xFFFF)
9      1      uint8        图片压缩格式 (最大 0xFF，当前为 0x01)
```

### 魔数

FFAB 文件的魔数为 `0xFFAB`，用于快速识别文件格式。

### 版本号

当前版本号为 `0x01`，用于未来格式升级。

### 图片总数

文件中包含的图片总数，最大支持 65535 张 (0xFFFF)。

### 图片宽度和高度

所有图片的统一尺寸，宽度和高度最大支持 65535 像素 (0xFFFF)。

### 图片压缩格式

指定图片数据的压缩格式：

| 值 | 格式 | 描述 |
|----|------|------|
| 0x01 | ASTC LDR 4x4 | ASTC LDR 4x4 压缩 |
| 0x02 | ASTC LDR 6x6 | ASTC LDR 6x6 压缩 |
| 0x03 | ASTC LDR 8x8 | ASTC LDR 8x8 压缩 |

## 索引表格式

索引表是一个结构体数组，每个元素对应一张图片，包含该图片在文件中的位置和长度信息。

### 索引项结构

每个索引项固定为 12 字节：

```
偏移量  长度     类型         描述
0       8      uint64       图片数据偏移量 (相对于文件开始)
8       4      uint32       图片数据长度 (字节) 
```

### 索引表总长度

索引表总长度 = 图片总数 × 12 字节

## 图片数据区

图片数据区按顺序存储所有压缩后的图片数据。每张图片的数据可以独立解压，不影响其他图片。

### 数据布局

```
+------------------+
|   图片1数据       |
+------------------+
|   图片2数据       |
+------------------+
|   ...             |
+------------------+
|   图片N数据       |
+------------------+
```

## 文件扩展名

FFAB 文件使用 `.ffab` 作为扩展名。

MIME 类型为 `application/x-ffa-bundle`。

## 兼容性

FFAB 格式设计考虑了向前兼容性：

- 新版本可以添加新的压缩格式
- 新版本可以扩展文件头，但保持前 24 字节不变
- 旧版本可以忽略不理解的压缩格式

## 工具支持

FFAB 格式提供以下工具支持：

1. **打包工具**：将图片序列打包为 FFAB 文件
2. **解包工具**：将 FFAB 文件解包为图片序列
3. **分析工具**：分析 FFAB 文件结构和内容
